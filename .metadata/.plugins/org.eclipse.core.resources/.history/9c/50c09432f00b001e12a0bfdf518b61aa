<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="css/supportWrite.css">

    <!-- include libraries(jQuery, bootstrap) -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	
	<!-- include summernote css/js -->
	<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
</head>
<body>
	<div th:replace="~{../common/header :: header}"></div>

<div>
	<section style="display: flex;">
	<div th:replace="~{../common/sidebar :: sidebar}"></div>

		<section id="supportListSection">

        <div>
            <div id="supportWrite">후원 신청</div>
        </div>

        <div class="path">
            <a class="middle" href="#"><img class="homeIconSize" src="image/home.png"></a>
            <img class="sub iconSize" src="image/onenext.png">
            <a class="middle" href="#">후원 내역</a>
            <img class="sub iconSize" src="image/onenext.png">
            <a class="middle">후원 신청 내역</a>
            <img class="sub iconSize" src="image/onenext.png">
            <a class="middle">후원 신청하기</a>
        </div>


        <section class="v-apply-info">
        	<form id="vForm" action="insertVolunteer.vo" method="post">
	            <table class="v-table">
	                <tr>
	                	<td colspan="2" rowspan="5">사진 첨부</td>
	                    <td>카테고리</td>
	                    <td colspan="3">
	                        <span class="dropdown" id="area-dropdown">
	                            <button type="button" class="dropdown-btn" id="areabtn">선택</button>
	                            <input type="hidden" id="area" name="supportCategory" value="none" required/>
	                            <div class="dropdown-content" id="area-content">
	                                <span class="selectArea">사람</span>
	                                <span class="selectArea">동물</span>
	                                <span class="selectArea">환경</span>
	                                <span class="selectArea">기타</span>
	                            </div>
	                        </span>  
	                    </td>
	                </tr>
	                <tr>
	                    <td>제목</td>
	                    <td colspan="3">
	                        <input type="text" name="supportTitle" maxlength="40" required/>
	                    </td>
	                </tr>
	                <tr>
	                    <td width="15%">후원기간</td>
	                    <td width="35%">
	                        <div class="dateDiv">
	                            <input type="date" id="startDate" name="startDate" required/><span class="date-delimeter"></span><input type="date" id="endDate" name="endDate" required/>
	                        </div>
	                    </td>
	                    
	                </tr>
	                <tr>
	                    <td>목표 금액</td>
	                    <td><input type="number" id="vCountAll" name="vCountAll" min="1" max="100" required/>원</td>
	                </tr>
	                <tr>
	                    <td>후원 기관</td>
	                    <td class="td-padding" >
	                       [[${session.loginUser.registrar}]]
	                    </td>
	                </tr>
	   				<tr>
	                    <td colspan="4">
	                        <textarea id="summernote" name="supportContent" required></textarea>
	                    </td>
	                </tr>
	            </table>
		        <div>
		            <button class="learn-more" id="modal-open" type="button">신청하기</button>
		            <button class="learn-more" type="button" onclick="supportApplicationListUser.su">취소하기</button>
		        </div> 
            </form>
		
			
    	</section>
		
</section>
</section>



</div>


<!-- 모달창 -->
<div class="container"> 
  <div class="popup-wrap" id="popup">
    <div class="popup">
      <div class="popup-head">
          <span class="head-title">선 뜻</span>
      </div>
      <div class="popup-body">
        <div class="body-content">
          <div class="body-titlebox">
          	<img src="image/heart2.png" id="modal-emoticon"><br>
            <h2>신청하시겠습니까?</h2>
          </div>
          <div class="body-contentbox">
            <p> 수정이 불가능하니 한번 더 확인해주세요 </p>
            <p> 모금함 게시에는 다소 시간이 소요될 수 있습니다.</p><br>
          </div>
        </div>
      </div>
      <div class="popup-foot">
        <span class="pop-btn confirm" id="confirm">신청</span>
        <span class="pop-btn confirm" id="close">취소</span>
      </div>
    </div>
</div>
</div>

<script>
$(function(){
	  $("#confirm").click(function(){
	      document.getElementById('supportApply').submit();
	  });
	  $("#modal-open").click(function(){   
	      $("#popup").css('display','flex').hide().fadeIn();
	      //팝업을 flex속성으로 바꿔준 후 hide()로 숨기고 다시 fadeIn()으로 효과
	  });
	  $("#close").click(function(){
	      modalClose(); //모달 닫기 함수 호출
	  });
	  function modalClose(){
	      $("#popup").fadeOut(); //페이드아웃 효과
	  }
	});
	

window.onload = () => {      	
	$('#summernote').summernote({
		placeholder: '내용을 입력하세요.',
		minHeight: 350,
		maxHeight: 350,
		lang : 'ko-KR',
		 toolbar: [
	          ['style', ['style']],
	          ['font', ['bold', 'underline', 'clear']],
	          ['color', ['color']],
	          ['para', ['paragraph']],
	          ['table', ['table']],
	          ['insert', ['link', 'picture', 'video']],
	          ['view', ['help']]
        ]
	});
	
	 
    	const categoryButton = document.querySelector('#areabtn')
    	categoryButton.addEventListener('click', ()=>{
    		document.querySelector('#area-content').style.display='block';
    		
    	})
    	
    	const category = document.querySelectorAll('.selectArea')
    	if(category !=null) {
    		category.addEventListener('click', function(){
    			categoryButton.innerText = this.innerHTML;
    			document.querySelector('#area').value = this.innerHTML;
    		})
    	}
    
	document.querySelector("#vCountAll").parentElement.addEventListener("click", () => {
		document.querySelector("#vCountAll").focus();
	});
	
	const startDate = document.querySelector("#startDate");
	const endDate = document.querySelector("#endDate");
	const rStartDate = document.querySelector("#rStartDate");
	const rEndDate = document.querySelector("#rEndDate");
	const startTime = document.querySelector("#startTime");
	const endTime = document.querySelector("#endTime");
	
	const now = new Date();
	const today = now.getFullYear() + "-" + ('0' + (now.getMonth() + 1)).slice(-2) + "-" + ('0' + now.getDate()).slice(-2);
	
	startDate.setAttribute("min", today);
	endDate.setAttribute("min", today);
	rStartDate.setAttribute("min", today);
	rEndDate.setAttribute("min", today);
	
	startDate.addEventListener("change", function() {
		endDate.setAttribute("min", this.value);
		rStartDate.setAttribute("max", this.value);
		rEndDate.setAttribute("max", this.value);
	});
	
	endDate.addEventListener("change", function() {
		rEndDate.setAttribute("max", this.value);
	});
	
	rStartDate.addEventListener("change", function() {
		rEndDate.setAttribute("min", this.value);
		startDate.setAttribute("min", this.value);
		endDate.setAttribute("min", this.value);
	});
	
    const selectAreas = document.getElementsByClassName("selectArea");
    const selectOnOffLines = document.getElementsByClassName("selectOnOffLine");
    const selectObjects = document.getElementsByClassName("selectObject");
    const selectMainCategories = document.getElementsByClassName("selectMainCategory");
    let checkMain = false;

    document.getElementById("subCategory-dropdown").style.display = "none";

    document.getElementById("areabtn").addEventListener("click", () => {
        document.getElementById("area-content").style.display = "block";
    });

    for(const selectArea of selectAreas) {
        selectArea.addEventListener("click", function() {
            document.getElementById("areabtn").innerText = this.innerText;
            document.getElementById("area").value = this.innerText;
            document.getElementById("area-content").style.display = "none";
        });
    }

    document.getElementById("on-offLineBtn").addEventListener("click", () => {
        document.getElementById("onoffLine-content").style.display = "block";
    });

    for(const selectOnOffLine of selectOnOffLines) {
        selectOnOffLine.addEventListener("click", function() {
            document.getElementById("on-offLineBtn").innerText = this.innerText;
            document.getElementById("onoffLine").value = this.innerText;
            document.getElementById("onoffLine-content").style.display = "none";
        });
    }

    document.getElementById("objectBtn").addEventListener("click", () => {
        document.getElementById("object-content").style.display = "block";
    });

    for(const selectObject of selectObjects) {
        selectObject.addEventListener("click", function() {
            document.getElementById("objectBtn").innerText = this.innerText;
            document.getElementById("object").value = this.getAttribute("data-value");
            document.getElementById("object-content").style.display = "none";
        });
    }

    document.getElementById("mainCategoryBtn").addEventListener("click", () => {
        document.getElementById("mainCategory-content").style.display = "block";
    });

    for(const selectMainCategory of selectMainCategories) {
        selectMainCategory.addEventListener("click", function() {
            document.getElementById("mainCategoryBtn").innerText = this.innerText;
            document.getElementById("mainCategory").value = this.getAttribute("data-value");
            document.getElementById("mainCategory-content").style.display = "none";
            document.querySelector('.subCategoryDelimiter').style.display = "inline-block";
            document.getElementById("subCategory-dropdown").style.display = "inline-block";
            if(checkMain) {
                deleteSubCategory();
            }
            createSubCategory(this.innerText);
            subCategoryEvent();
            checkMain = true;
        });
    }
	
    const vDays = document.getElementsByClassName("v-day");
    for(const vDay of vDays) {
        vDay.addEventListener("click", function() {
            this.classList.toggle("v-day-select");
        });
    }
    
    let vDayVal = '';
    let checkAllVal = false;
    document.querySelector("#enrollbtn").addEventListener("click", () => {
    	for(const vDay of vDays) {
            if(vDay.classList.contains("v-day-select")) {
            	vDayVal += vDay.innerText + ", ";
            }
        }
    	vDayVal = vDayVal.substr(0, vDayVal.length - 2);
    	document.querySelector("#vDay").value = vDayVal;
    	if(document.querySelector("#area").value === "none") {
    		alert("지역을 선택해주세요");
    	} else if(vDayVal === '') {
    		alert("요일을 선택해주세요");
    	} else if(document.querySelector("#onoffLine").value === "none") {
    		alert("활동구분을 선택해주세요");	
    	} else if(document.querySelector("#mainCategory").value === "none") {
    		alert("봉사분야를 선택해주세요");
    	} else if(document.querySelector("#subCategory").value === "none") {
    		alert("봉사분야(하위)를 선택해주세요");
    	} else if(document.querySelector("#object").value === "none") {
    		alert("봉사대상을 선택해주세요");
    	} else {
    		checkAllVal = true;
    	}
    	
    	if(!checkAllVal) {
    		event.preventDefault();
    	}
    	vDayVal = '';
    })
}

const convenienceSupport = ['활동보조', '이동지원', '청결지도', '급식지원', '식사·반찬지원', '기타'];
const residentalEnvironment = ['주거개선', '마을공동체활동', '기타'];
const consultation = ['말벗·상담', '전문상담', '기타'];
const education = ['방과후 교육', '학습지도 교육', '특수교육', '평생교육', '전문교육', '진로체험지도', '기타'];
const cultureEvent = ['행사보조', '공연활동', '캠페인', '관광안내', '사진촬영', '기타'];
const environmentalProtection = ['환경정화', '환경감시', '기타'];
const safetyPevention = ['지역안전', '교통안전', '어린이 안전', '청소년 안전', '취약계층 안전', '안전신고·활동', '기타'];
const disaster = ['피해복구', '긴급구조', '예방접종지원', '기타'];

const deleteSubCategory = () => {
    const subCategoryContent = document.getElementById("subCategory-content");
    while (subCategoryContent.firstChild) {
        subCategoryContent.removeChild(subCategoryContent.firstChild);
        document.getElementById("subCategoryBtn").innerText = "선택";
        document.getElementById("subCategory").value = "none";
    }
}

let subValue = 1;
const createSubCategory = (category) => {
    let subCateName = '';
    if(category == '생활편의지원') {
        subCateName = convenienceSupport;
        subValue = 1;
    } else if(category == '주거환경') {
        subCateName = residentalEnvironment;
        subValue = 7;
    } else if(category == '상담') {
        subCateName = consultation;
        subValue = 10;
    } else if(category == '교육') {
        subCateName = education;
        subValue = 13;
    } else if(category == '문화행사') {
        subCateName = cultureEvent;
        subValue = 20;
    } else if(category == '환경보호') {
        subCateName = environmentalProtection;
        subValue = 26;
    } else if(category == '안전·예방') {
        subCateName = safetyPevention;
        subValue = 29;
    } else if(category == '재해·재난') {
        subCateName = disaster;
        subValue = 36;
    }
    
    for(let i=0; i < subCateName.length; i++) {
        let spanElement = document.createElement("span");
        spanElement.classList.add("selectSubCategory");
        spanElement.textContent = subCateName[i];
        spanElement.setAttribute("data-value", subValue + i);
        document.getElementById("subCategory-content").appendChild(spanElement);
    }
}

const subCategoryEvent = () => {
    let selectSubCategories = document.getElementsByClassName("selectSubCategory");
    for(const selectSubCategory of selectSubCategories) {
        selectSubCategory.addEventListener("click", function() {
            document.getElementById("subCategoryBtn").innerText = this.innerText;
            document.getElementById("subCategory").value = this.getAttribute("data-value");
            document.getElementById("subCategory-content").style.display = "none";
        });
    }

    document.getElementById("subCategoryBtn").addEventListener("click", () => {
        document.getElementById("subCategory-content").style.display = "block";
    });
} 

</script>












<div th:replace="~{../common/footer :: footer}"></div>
</body>
</html>