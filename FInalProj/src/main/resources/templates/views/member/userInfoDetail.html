<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>회원 상세 조회</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
@font-face {
   font-family: 'SUITE-Regular';
   src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-2@1.0/SUITE-Regular.woff2') format('woff2');
   font-weight: 400;
   font-style: normal;
}
        
* {
   margin: 0;
   padding: 0;
   box-sizing: border-box;
   font-family: "SUITE-Regular", sans-serif;
}

::selection {
		background-color: #9DC08B;
		color: #fff;
	}

#normal-input {
	padding: 8px 15px 9px;
	border-radius: 4px;
	width: 180px;
	height: 33px;
	border: 1px solid lightgray;
	outline: none;
}

input[type="text"] {
  text-align: center; /* 가운데 정렬 설정 */
}

input[type="radio"] {
	accent-color: #609966;
	width: 14px;
	height: 14px;
}

#faqSection {
    margin-top: 80px;
    margin-left: 18%;
    display: flex;

    align-items: center;
    flex-direction: column; /* 세로 방향, row는 가로 방향 */
}

#faqTitle {
    font-size: 30px;
    border-bottom: 2px solid #40513B;
}

.path {
    margin-top: 30px;
    width: 740px;
    font-size: 14px;
    margin-bottom: 20px;
}

.middle {
    vertical-align: middle;
    text-decoration: none;
    color: black;
}

.iconSize {
    block-size: 12px;
}

.homeIconSize {
    block-size: 14px;
}

.sub {
    vertical-align: sub;
}

.writeFaqBtn {
    width: 80px;
    height: 25px;
    background-color: #9DC08B;
    color: white;
    border-radius: 0.4rem;
    cursor: pointer;
    border: 1px solid black;
    font-size: 14px;
}

.actionArea {
    margin-top: 30px;
    width: 750px;
}

.writeArea {
    float: left;
}

.searchArea {
    float: right;
}

.faqTable {
    width: 750px;
    margin-top: 10px;
    padding: 10px;
    text-align: center;
    border-width: 1px;
    border-style: solid;
    border-color: black;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 15px;
    border-radius: 10px;
}

th, td {
    padding: 10px;
}

.title { width: 268px; }
td { width: 460px; }

.faqTable thead tr th {
    border-bottom: 1px dotted black;
    background-color: #EDF1D6;
}

.first {
    border-radius: 10px 0px 0px 0px;
}

.last {
    border-radius: 0px 0px 0px 10px;
}

.title {
    border-right: 1px dotted black;
    background-color: #EDF1D6;
}

.page {
    margin-top: 35px;
    display: flex;
    flex-direction: row;
}

.pagination > li {
    list-style-type: none;
    float: left;
}

.pagination > li > .num {
    margin: 10px;
    width: 20px;
    height: 20px;
    text-decoration-line: none;
    color: black;
    font-size: 16px;
    display: inline-block;
    text-align: center
}

.pagination > li > .num:hover {
    color: white;
    background-color: #40513B;
    border-radius: 100%;
}

.arrowKey {
    margin-top: 12px;
    margin-left: 10px;
    margin-right: 10px;
    block-size: 14px;
    display: block;
}

.faqTable > tbody > tr:hover{
    background-color: #f9fceb;
    cursor: pointer;
}

/* 토글 */
input[type=checkbox] {
  height: 0;
  width: 0;
  visibility: hidden;
}

.switch {
  cursor: pointer;
  text-indent: -9999px;
  width: 50px; /* 너비 조절 */
  height: 26px; /* 높이 조절 */
  background: gray;
  display: block;
  border-radius: 50px; /* 원형 모양 조절 */
  position: relative;
  justify-content: center;
  align-items: center;
  vertical-align: middle;
  top: -10px;
}

.switch:after {
  content: '';
  position: absolute;
  top: 3.6px; /* 상단 위치 조절 */
  left: 4.5px; /* 왼쪽 위치 조절 */
  width: 18px; /* 너비 조절 */
  height: 18px; /* 높이 조절 */
  background: #fff;
  border-radius: 18px; /* 원형 모양 조절 */
  transition: 0.3s;
}

input:checked + .switch {
  background: #9DC08B;
}

input:checked + .switch:after {
  left: calc(100% - 4.5px);
  transform: translateX(-100%);
}

.switch:active:after {
  width: 30px; /* 너비 조절 */
}

.switch-div {
	justify-content: center;
  	align-items: center;
  	display: inline-block;
  	vertical-align: middle;
}

.select-cate {
	width: 90px;
    height: 30px;
    border-radius: 0.4rem;
    background-color: #f3f3f3;
}

.cate-btn {
	padding: 8px 15px 9px;
	border-radius: 30px;
	width: 111px;
	height: 33px;
	font-size: 13px;
	color: #9DC08B;
	background-color: #fff;
	border: 1.5px solid #9DC08B;
}

.isstatus-user {
	display: inline-block;
}

.switch-div {
	display: inline-block;
	margin-left: 5px;
}

.admin-user {
	margin-left: 10px;
}

.normal-btn {
	margin-top: 60px;
	padding: 8px 15px 9px;
	border-radius: 4px;
	width: 300px;
	height: 40px;
	font-size: 15px;
	color: white;
	background-color: #609966;
	border: 1px solid #609966;
	cursor: pointer;
}

.vibration{animation: vibration 0.1s infinite;}
@Keyframes vibration{
	from{transform: rotate(1deg);}
	to{transform: rotate(-1deg);}
}

</style>
</head>
<body>
<div th:replace="~{views/common/header :: header}"></div>

<div>
    <section style="display: flex;">
	<div th:replace="~{views/common/adminSidebar :: adminSidebar}"></div>
	
	<section id="faqSection">
        <div>
            <div id="faqTitle">회원 상세</div>
        </div>

        <div class="path">
            <a class="middle" href="#"><img class="homeIconSize" src="image/home.png"></a>
            <img class="sub iconSize" src="image/화살표.png">
            <a class="middle" href="#">관리자 페이지</a>
            <img class="sub iconSize" src="image/화살표.png">
            <a class="middle">회원</a>
        </div>

		<div class="actionArea">
			<div class="isstatus-user">회원 활동 여부</div>
			<div class="switch-div">
			  <input type="checkbox" id="switch" th:checked="${uList.uStatus == 'Y'}" />
			  <label for="switch" class="switch">Toggle</label>
			</div>
        </div>

        <table class="faqTable">
            <tbody>
                <tr>
                    <td class="title first" th:text="${ uList.uId == null ? '카카오아이디' : '아이디' }">아이디</td>
                    <td th:text="${ uList.uId != null ? uList.uId : uList.kakaoId }"></td>
                </tr>
                <tr>
                    <td class="title">이름</td>
                    <td th:text="${ uList.uName }"></td>
                </tr>
                <tr>
                    <td class="title">생년월일</td>
                    <td th:text="${ uList.residentNo }"></td>
                </tr>
                <tr>
                    <td class="title">주소</td>
                    <td th:text="${ uList.address != null ? uList.address : '-' }"></td>                   
                </tr>
                <tr>
                    <td class="title">전화번호</td>
                    <td th:text="${ uList.phone != null ? uList.phone : '-' }"></td>
                </tr>
                <tr>
                    <td class="title">이메일</td>
                    <td th:text="${ uList.email }"></td>
                </tr>
                <tr>
                    <td class="title">닉네임</td>
                    <td th:text="${ uList.uNickName }"></td>
                </tr>
                <tr>
                    <td class="title">가입타입</td>
                    <td th:text="${ uList.loginType }"></td>
                </tr>
                <tr>
                    <td class="title">회원 유형</td>
                    <td th:text="${ uList.uType }"></td>
                </tr>
                <tr>
                	<td class="title">등록 기관</td>
                    <td th:text="${uList.registrar != null ? uList.registrar : '-'}"></td>
                </tr>
                <tr>
                	<td class="title">관리자 여부</td>
                    <td th:text="${uList.isAdmin == 1 ? '일반' : (uList.isAdmin == 0 ? '관리자' : (uList.isAdmin == 2 ? '봉사관리자' : ''))}"></td>
                </tr>
                <tr>
                	<td class="title last">가입 일자</td>
                    <td th:text="${ uList.enrollDate }"></td>
                </tr>
            </tbody>
        </table>
        
        <div class="address-btn">
			<button class="normal-btn" id="search-ad" onClick="history.back();">목록으로</button>
		</div>		

        </section>
    </section>
  </div>
  
<br><br><br><br>
<div th:replace="~{views/common/footer :: footer}"></div>
<script th:inline="javascript">
		let beforeData = null;
		const tds = document.getElementsByTagName('td');
		
		document.querySelector('body').addEventListener('click', (event)=>{
			for(let i = 0; i < tds.length; i++){
				if(tds[i].children[0] != undefined && tds[i].children[0].value != undefined){
					if(event.target.value == undefined){
						tds[i].innerHTML = '<td>' + beforeData + '</td>';
						console.log("beforData = " + beforeData);
					}				
				}
			}
		})
		
		for(let i = 0; i < tds.length; i++){
			const index = i;
					
			tds[i].addEventListener('dblclick', function(){
				if(index % 2 === 1){
					for(let j = 0; j < tds.length; j++){
						if(tds[j].children[0] != undefined && tds[j].children[0].value != undefined){
							tds[j].innerHTML = '<td>' + tds[j].children[0].value + '</td>';
							console.log("tds[j].innerHTML = " + tds[j].innerHTML);
						}
					}
				} else { return; }
				
				// 더블클릭해서 수정칸 만들기
				
				if(index != 1 && index != 15 && index != 23){
					beforeData = this.innerText;
					
					if(index == 17){ // 회원 유형
						let checked = null;
						if(beforeData == '일반'){
							checked = '<input type="radio" name="uType" class="updateData" value="일반" checked> 일반\
									   <input type="radio" name="uType" class="updateData" value="단체"> 단체';
						} else if(beforeData == '단체'){
							checked = '<input type="radio" name="uType" class="updateData" value="일반"> 일반\
									   <input type="radio" name="uType" class="updateData" value="단체" checked> 단체';
						}
						
						this.innerHTML = checked;
						
					} else if(index == 21){ // 관리자 여부
						let checked = null;
						if(beforeData == '일반'){
							checked = '<input type="radio" name="isAdmin" class="updateData" value="일반" checked> 일반\
									   <input type="radio" name="isAdmin" class="updateData" value="관리자"> 관리자\
									   <input type="radio" name="isAdmin" class="updateData" value="봉사 관리자"> 봉사 관리자';
						} else if(beforeData == '관리자'){
							checked = '<input type="radio" name="isAdmin" class="updateData" value="일반"> 일반\
								   	   <input type="radio" name="isAdmin" class="updateData" value="관리자" checked> 관리자\
								       <input type="radio" name="isAdmin" class="updateData" value="봉사 관리자"> 봉사 관리자';
						} else if(beforeData == '봉사 관리자'){
							checked = '<input type="radio" name="isAdmin" class="updateData" value="일반"> 일반\
							   		   <input type="radio" name="isAdmin" class="updateData" value="관리자"> 관리자\
							   		   <input type="radio" name="isAdmin" class="updateData" value="봉사 관리자" checked> 봉사 관리자';
						}
						
						this.innerHTML = checked;
					} else { // 나머지
						this.innerHTML = '<input type="text" id="normal-input" class="updateData" value="' + this.innerText + '">';
					}
					
					// 데이터 수정 ajax 적용
					const updateDatas = document.getElementsByClassName('updateData');
					for(const update of updateDatas){
						update.addEventListener('keyup', function(event){
							if(event.key == 'Enter'){
								let datas = '';
								if(updateDatas[0].type == 'radio'){
									for(let i = 0; i < updateDatas.length; i++){
										if(updateDatas[i].checked){
											datas = updateDatas[i].value;
											break;
										}
									}
								} else {
									for(let i = 0; i < updateDatas.length; i++){
										if(i == 0){
											datas = updateDatas[i].value;
										} else {
											datas += '@' + updateDatas[i].value;
										}
									}
								}
																						
								
								if(index != 13) { // 닉네임이 아닐 때
									$.ajax({
									url: 'updateUserInfo.me',
									/*<![CDATA[*/
									data: {data:datas, column:document.querySelectorAll('td')[index].previousElementSibling.innerText, uNo:/*[[${uList.uNo}]]*/''},
									/*]]>*/
									success: data => {
										if(data == 'success'){
											tds[i].innerHTML = '<td>' + datas + "</td>";
										} else { // fail
											alert('수정이 실패하여 페이지가 새로고침 됩니다.');
											location.reload();
										}
									},
									error: data => {
										console.log(data);
									}
								});
							} else {
								$.ajax({
									url: 'checkNickName.me',
									data: {uNickName: datas},
									success : data => {
										if(data == 'yes'){
											$.ajax({
											url: 'updateUserInfo.me',
											/*<![CDATA[*/
											data: {data:datas, column:document.querySelectorAll('td')[index].previousElementSibling.innerText, uNo:/*[[${uList.uNo}]]*/''},
											/*]]>*/
											success: data => {
												if(data == 'success'){
													tds[i].innerHTML = '<td>' + datas + "</td>";
												} else { // fail
													alert('수정이 실패하여 페이지가 새로고침 됩니다.');
													location.reload();
												}
											},
											error: data => {
												console.log(data);
											}
										});
									} else {
										this.classList.add('vibration');
										
										setTimeout(()=>{
											this.classList.remove('vibration');
										}, 400);
									}
								},
								error : data => {
									console.log(data);
								}
							})
						}
					}
				})
			}
									
			} else {
				alert('수정할 수 없는 항목입니다.');
			}
		});
		}
		
		const stateButton = document.getElementById('switch');
		console.log(stateButton);
		 stateButton.addEventListener('click', function(){
			 if(stateButton.checked){
				 this.value = "Y";
			 } else {
				 this.value = "N";
			 }
					$.ajax({
						url: 'updateState.me',
						/*<![CDATA[*/
						data: {uNo:/*[[${uList.uNo}]]*/'', value:this.value},
						/*]]>*/
						success: data => {
							if(data == 'success'){
								if(value === "Y"){
									stateButton.checked = true;
								} else {
									stateButton.checked = false;
								}
							} else {
								alert('상태 변경에 실패하여 페이지가 새로고침 됩니다.');
								location.reload();
							}
						},
						error: data => {
							console.log(data);
						}
					});
				})		
			

</script>
</body>
</html>